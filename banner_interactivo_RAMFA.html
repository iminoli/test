<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>RAMFA - Portada</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet" />
  <!-- Font Awesome Icons -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" xintegrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    body {
      font-family: 'Montserrat', sans-serif;
      background-color: #f8f9fa;
      color: #2d3748;
    }
    .bg-natural-green {
      background-color: #4A7C59;
    }
    .text-natural-green {
      color: #4A7C59;
    }
    .btn-gemini {
      background-color: #4A7C59;
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 600;
      transition: background-color 0.3s ease, transform 0.2s ease;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .btn-gemini:hover {
      background-color: #3e684b;
      transform: translateY(-2px);
    }
    .loader {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #ffffff;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>

<body class="flex items-center justify-center min-h-screen p-4">

  <div class="w-full max-w-6xl bg-white shadow-xl rounded-lg overflow-hidden flex flex-col">

    <!-- Franja superior verde -->
    <div class="bg-natural-green h-4 sm:h-6 w-full"></div>

    <!-- Contenido principal -->
    <main class="flex-grow flex flex-col items-center justify-center py-8 px-6 sm:py-12 sm:px-10 text-center">
      
      <div class="w-48 sm:w-64 md:w-80 mb-6">
        <img alt="Logo de la Red Argentina de Monitoreo de Fauna Atropellada" class="w-full" src="https://www.dropbox.com/scl/fi/u1zarv0rlyhlylcu78nfo/Logo_RAMFA_vert_osc_Blanco.png?rlkey=ggjb224tpz9ospro6689frzrc&st=4l6lqbq2&dl=1" />
      </div>

      <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold text-natural-green">Red Argentina de Monitoreo de Fauna Atropellada</h1>
      
      <div class="w-20 h-1 bg-natural-green my-6"></div>

      <h2 class="text-lg sm:text-xl md:text-2xl font-semibold text-natural-green max-w-4xl">
        Proyecto interinstitucional de ciencia ciudadana para el monitoreo participativo
      </h2>

      <p class="text-base sm:text-lg text-gray-700 mt-6 max-w-4xl">
        Una iniciativa abierta para el registro de atropellamientos de fauna silvestre en rutas de Argentina, basada en aplicaciones móviles de acceso libre y participación ciudadana.
      </p>

      <!-- Botones de Gemini API -->
      <div class="mt-10 flex flex-col sm:flex-row gap-4 justify-center items-center">
          <button id="identify-species-btn" class="btn-gemini">✨ Ayúdame a identificar una especie</button>
          <button id="safety-tip-btn" class="btn-gemini">✨ Generar consejo de seguridad</button>
      </div>
      <div id="safety-tip-container" class="mt-6 text-gray-600 italic max-w-2xl mx-auto min-h-[40px] flex items-center justify-center p-2 rounded-md"></div>

      <!-- Íconos de descripción -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-8 md:gap-12 mt-12 w-full max-w-4xl">
        <div class="flex flex-col items-center">
          <i class="fas fa-map-marker-alt text-4xl text-natural-green mb-3"></i>
          <p class="font-semibold">Monitoreo geográfico</p>
        </div>
        <div class="flex flex-col items-center">
          <i class="fas fa-users text-4xl text-natural-green mb-3"></i>
          <p class="font-semibold">Participación ciudadana</p>
        </div>
        <div class="flex flex-col items-center">
          <i class="fas fa-paw text-4xl text-natural-green mb-3"></i>
          <p class="font-semibold">Conservación de fauna</p>
        </div>
        <div class="flex flex-col items-center">
          <i class="fas fa-road text-4xl text-natural-green mb-3"></i>
          <p class="font-semibold">Seguridad vial</p>
        </div>
      </div>

    </main>

    <!-- Pie de página -->
    <footer class="bg-natural-green text-white py-4 px-6 sm:px-8 flex flex-col sm:flex-row justify-between items-center text-sm gap-2 sm:gap-0">
      <a href="http://www.fauna-atropellada.org.ar" target="_blank" rel="noopener noreferrer" class="hover:underline">www.fauna-atropellada.org.ar</a>
      <span>Creación y diseño: Ignacio Minoli</span>
      <span id="current-year"></span>
    </footer>
  </div>

  <!-- Modal de Identificación de Especies -->
  <div id="species-modal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center p-4 z-50">
    <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-lg relative animate-fade-in">
        <button id="close-modal-btn" class="absolute top-3 right-3 text-2xl text-gray-500 hover:text-gray-800">&times;</button>
        <h3 class="text-2xl font-bold text-natural-green mb-4">✨ Asistente de Identificación</h3>
        <p class="mb-4 text-gray-600">Describe el animal que viste (tamaño, color, características, comportamiento, etc.) y la ubicación. ¡Nuestra IA te ayudará a identificarlo!</p>
        <textarea id="species-description" class="w-full h-32 p-2 border rounded-md focus:ring-2 focus:ring-natural-green focus:outline-none" placeholder="Ej: Vi un animal mediano con pelaje marrón, orejas pequeñas y redondas, cerca de un río en la provincia de Corrientes. Parecía estar comiendo plantas acuáticas."></textarea>
        <button id="submit-identification-btn" class="mt-4 w-full bg-natural-green text-white py-2 px-4 rounded-lg hover:bg-opacity-90 flex items-center justify-center transition-all duration-300 h-10">
            <span class="btn-text">Identificar</span>
            <div class="loader hidden"></div>
        </button>
        <div id="identification-result" class="mt-4 p-4 bg-gray-50 rounded-md min-h-[50px] text-gray-700"></div>
    </div>
  </div>

  <script>
    document.getElementById('current-year').textContent = new Date().getFullYear();

    // --- Gemini API Integration ---

    const identifySpeciesBtn = document.getElementById('identify-species-btn');
    const safetyTipBtn = document.getElementById('safety-tip-btn');
    const safetyTipContainer = document.getElementById('safety-tip-container');
    const speciesModal = document.getElementById('species-modal');
    const closeModalBtn = document.getElementById('close-modal-btn');
    const submitIdentificationBtn = document.getElementById('submit-identification-btn');
    const speciesDescription = document.getElementById('species-description');
    const identificationResult = document.getElementById('identification-result');

    const apiKey = ""; // Canvas will provide this
    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

    // Function to call Gemini API with exponential backoff
    async function callGeminiAPI(prompt, maxRetries = 3) {
      let attempt = 0;
      while (attempt < maxRetries) {
        try {
          const payload = {
            contents: [{ parts: [{ text: prompt }] }],
          };
          const response = await fetch(apiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload),
          });

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const result = await response.json();
          if (result.candidates && result.candidates[0].content.parts[0].text) {
             return result.candidates[0].content.parts[0].text;
          } else {
             throw new Error('Invalid response structure from API.');
          }
        } catch (error) {
          console.error(`API call failed on attempt ${attempt + 1}:`, error);
          attempt++;
          if (attempt >= maxRetries) {
             return "Lo siento, no pude procesar la solicitud en este momento. Por favor, intenta de nuevo más tarde.";
          }
          const delay = Math.pow(2, attempt) * 1000;
          await new Promise(res => setTimeout(res, delay));
        }
      }
    }

    // --- Species Identification Feature ---

    identifySpeciesBtn.addEventListener('click', () => {
      speciesModal.classList.remove('hidden');
      speciesModal.classList.add('flex');
    });

    const closeModal = () => {
      speciesModal.classList.add('hidden');
      speciesModal.classList.remove('flex');
    };
    
    closeModalBtn.addEventListener('click', closeModal);
    speciesModal.addEventListener('click', (e) => {
        if (e.target === speciesModal) {
            closeModal();
        }
    });

    submitIdentificationBtn.addEventListener('click', async () => {
      const description = speciesDescription.value.trim();
      if (!description) {
        identificationResult.textContent = 'Por favor, ingresa una descripción.';
        return;
      }
      
      const btnText = submitIdentificationBtn.querySelector('.btn-text');
      const loader = submitIdentificationBtn.querySelector('.loader');

      btnText.classList.add('hidden');
      loader.classList.remove('hidden');
      submitIdentificationBtn.disabled = true;
      identificationResult.textContent = 'Analizando descripción...';

      const prompt = `Actúa como un biólogo experto en fauna de Argentina. Un ciudadano ha visto un animal y necesita ayuda para identificarlo. Basado en la siguiente descripción, proporciona una posible identificación. Incluye el nombre común en negrita, el nombre científico entre paréntesis, y una breve descripción de 1-2 frases. Si no estás seguro, ofrece algunas posibilidades. La descripción es: "${description}"`;
      
      const result = await callGeminiAPI(prompt);
      
      // Basic markdown to HTML conversion for bold text
      identificationResult.innerHTML = result.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
      
      btnText.classList.remove('hidden');
      loader.classList.add('hidden');
      submitIdentificationBtn.disabled = false;
    });

    // --- Road Safety Tip Feature ---

    safetyTipBtn.addEventListener('click', async () => {
        safetyTipContainer.textContent = 'Generando consejo...';
        safetyTipBtn.disabled = true;

        const prompt = "Actúa como un experto en seguridad vial y conservación de la fauna argentina. Genera un consejo de seguridad vial corto y práctico (1-2 frases) para que los conductores eviten atropellar animales. El consejo debe ser relevante para la ubicación y hora actual: son las 9 AM en Posadas, Misiones, Argentina, un día de semana. Varía el consejo en cada solicitud.";

        const result = await callGeminiAPI(prompt);
        safetyTipContainer.textContent = `"${result}"`;
        safetyTipBtn.disabled = false;
    });

  </script>
</body>
</html>




